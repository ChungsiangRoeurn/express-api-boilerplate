generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    USER
}

enum OrderEventStatus {
    PENDING
    ACCEPTED
    OUT_FOR_DELIVERY
    DELIVERED
    CANCELLED
}

model User {
    id                          Int                 @id @default(autoincrement())
    name                        String
    email                       String              @unique
    password                    String
    role                        Role                @default(USER)
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt
    defaultShippingAddress      Int?
    defaultBillingAddress       Int?
    cartItems                   CartItems[]
    orders                      Order[]

    addresses       Address[]
    @@map("user")
}

model Address {
    id                          Int                 @id @default(autoincrement())
    lineOne                     String
    lineTwo                     String?
    city                        String
    country                     String
    pincode                     String
    userId                      Int
    user                        User                @relation(fields: [userId], references: [id])
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt

    @@map("addresses")
}

model Products {
    id                          Int                 @id @default(autoincrement())
    name                        String
    description                 String
    price                       Decimal
    tags                        String
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt
    cartItems                   CartItems[]
    order                       OrderProduct[]

    @@map("products")
}

model CartItems {
    id                          Int                 @id @default(autoincrement())
    userId                      Int
    productId                   Int
    quantity                    Int
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt
    user                        User                @relation(fields: [userId], references: [id])
    product                     Products            @relation(fields: [productId], references: [id])

    @@map("cart_items")
}

model Order {
    id                          Int                 @id @default(autoincrement())
    userId                      Int
    user                        User                @relation(fields: [userId], references: [id])
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt
    netAmount                   Decimal
    address                     String

    products                    OrderProduct[]
    events                      OrderEvent[]

    @@map("orders")
}

model OrderProduct{
    id                          Int                 @id @default(autoincrement())
    orderId                     Int
    productId                   Int
    order                       Order               @relation(fields: [orderId], references: [id])
    product                     Products            @relation(fields: [productId], references: [id])
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt
    quantity                    Int

    @@map("order_products")
}

model OrderEvent {
    id                          Int                 @id @default(autoincrement())
    orderId                     Int
    order                       Order               @relation(fields: [orderId], references: [id])
    status                      OrderEventStatus    @default(PENDING)
    createdAt                   DateTime            @default(now())
    updatedAt                   DateTime            @updatedAt

    @@map("order_events")
}